# طرح توسعه ماژول ثبت علائم حیاتی پیشرفته (Vital Signs Module)

این طرح برای پیاده‌سازی یک سیستم هوشمند، دقیق و کاربرپسند جهت ثبت علائم حیاتی بر اساس ۱۵ اصل درخواستی شما تدوین شده است.

## فاز ۱: زیرساخت Backend (توسعه مدل داده)

### ۱.۱. به‌روزرسانی موجودیت `CareRecipient` (بیمار)
برای مدیریت زمان‌بندی هوشمند، سطح مراقبت بیمار ضروری است:
- **افزودن `CareLevel`**:
  - `Critical` (هر ۲ ساعت)
  - `High` (هر ۴ ساعت)
  - `Medium` (هر ۶ ساعت)
  - `Low` (هر ۱۲ ساعت)

### ۱.۲. به‌روزرسانی موجودیت `VitalSign`
- **افزودن فیلدهای کنترلی**:
  - `MeasuredAt`: زمان واقعی اندازه‌گیری (متفاوت از زمان ثبت).
  - `IsLateEntry`: فلگ برای نشان دادن ثبت با تاخیر.
  - `DelayReason`: دلیل تاخیر (اگر دیر ثبت شده).
  - `Note`: یادداشت کوتاه پرستار.
  - `MAP`: فشار متوسط شریانی (محاسبه شده).

### ۱.۳. به‌روزرسانی DTOها و سرویس‌ها
- آپدیت `CreateVitalSignDto` برای دریافت فیلدهای جدید.
- محاسبه خودکار `MAP` در سمت سرور (به عنوان لایه اطمینان) یا دریافت از کلاینت.

---

## فاز ۲: طراحی و پیاده‌سازی Frontend

### ۲.۱. کامپوننت هوشمند `VitalSignForm` (فرم ثبت)
این فرم به صورت **Modal** یا **Drawer** پیاده‌سازی می‌شود تا دسترسی سریع باشد.

#### ویژگی‌های فرم:
- **Time Handling**:
  - فیلد `MeasuredAt` به صورت پیش‌فرض روی "اکنون" است.
  - اگر زمان انتخاب شده اختلاف زیادی با زمان فعلی داشته باشد، فیلد "دلیل تاخیر" ظاهر می‌شود.
- **Inputs & Validations**:
  - **فشار خون**: دو فیلد سیستول/دیاستول. محاسبه آنی `MAP` و نمایش آن.
  - **هشدار هوشمند (Soft Validation)**: اگر مقادیر خارج از رنج نرمال باشند (مثلاً تب > ۳۸ یا SpO2 < ۹۰)، فیلد زرد می‌شود و پیام هشدار بالینی نمایش داده می‌شود اما مانع ثبت نمی‌شود (مگر مقادیر غیرممکن).
  - **GCS**: محاسبه‌گر کمکی (Eye + Verbal + Motor) به صورت Dropdownهای سریع.
- **Quick Presets**: دکمه "ثبت نرمال" برای پر کردن سریع مقادیر پیش‌فرض (۱۲/۸ - ۳۷ - ۱۸ - ۹۸٪) جهت سرعت بخشیدن در شرایط روتین.

### ۲.۲. داشبورد علائم حیاتی (`VitalSignsTab`)
- **کارت وضعیت (Status Card)**:
  - نمایش زمان آخرین ثبت.
  - **Countdown Timer**: شمارش معکوس تا نوبت بعدی ثبت (بر اساس `CareLevel`).
  - هشدار رنگی (سبز: نرمال، زرد: نزدیک به موعد، قرمز: تاخیر).
- **نمودار روند (Trend Chart)**:
  - استفاده از `recharts` برای نمایش نمودار خطی دما، فشار خون و ضربان قلب در ۲۴ ساعت گذشته.
- **جدول داده‌ها**: با قابلیت اکسپورت CSV.

---

## فاز ۳: پیاده‌سازی Logic و Helpers
- **`ClinicalHelper`**: توابع جاوااسکریپتی برای محاسبه MAP، تشخیص وضعیت بحرانی، و تعیین رنگ‌بندی مقادیر.
- **`ScheduleHelper`**: تابع محاسبه زمان بعدی ثبت بر اساس سطح مراقبت.

## گام‌های اجرایی
۱. آپدیت Backend (موجودیت‌ها و DTO).
۲. ایجاد کامپوننت `VitalSignForm` با React Hook Form و Zod.
۳. ادغام فرم و نمودار در `VitalSignsTab`.
۴. تست سناریوهای مختلف (ثبت با تاخیر، مقادیر بحرانی).