# بازطراحی جامع ماژول دارو و کاردکس (Medication & Kardex Redesign Plan)

این طرح با حفظ **تمام فیلدهای موجود** و با تمرکز بر **کاربردپذیری بالینی (Clinical Usability)** تدوین شده است. هدف اصلی کاهش بار شناختی کادر درمان و افزایش ایمنی بیمار است.

## ۱. تحلیل جریان کاربری (UX Flow)

### الف) پنل پرستار/پزشک (Admin & Nurse Panel)
**نکته:** هر دو نقش از یک فرم استاندارد و کامل برای ثبت دارو استفاده می‌کنند تا داده‌ها یکپارچه باشند.

**۱. ثبت تجویز دارو (Prescription Wizard)**
تمام فیلدهای فعلی در یک فرآیند ۴ مرحله‌ای (Progressive Disclosure) سازماندهی می‌شوند:

*   **گام ۱: مشخصات دارو (Clinical Info)**
    *   *فیلدها:* نام دارو (Name)، شکل دارویی (Form)، دوز (Dosage)، روش مصرف (Route).
    *   *UX:* استفاده از Select/Combobox برای Route و Form جهت سرعت بیشتر.
*   **گام ۲: زمان‌بندی (Scheduling)**
    *   *فیلدها:* نوع تکرار (FrequencyType)، جزئیات زمان‌بندی (Time Entries / Interval)، تاریخ شروع (StartDate)، تاریخ پایان (EndDate).
    *   *UX:* نمایش پویای انتخابگر ساعت بر اساس نوع تکرار (مثلاً انتخاب "روزانه" -> نمایش افزودن ساعت‌ها).
*   **گام ۳: هشدارها و تنظیمات (Safety & Alerts)**
    *   *فیلدها:* سطح اهمیت (Criticality)، وضعیت High Alert، وضعیت PRN (در صورت نیاز)، مهلت مصرف (Grace Period)، فعال‌سازی Escalation.
    *   *UX:* دکمه‌های Toggle بزرگ برای High Alert و PRN.
*   **گام ۴: اطلاع‌رسانی و دستورات (Notification & Instructions)**
    *   *فیلدها:* دستورالعمل (Instructions)، چک‌باکس‌های اطلاع‌رسانی (Notify Patient, Nurse, Supervisor, Family).
    *   *UX:* گروه‌بندی چک‌باکس‌های اطلاع‌رسانی در یک کادر مشخص.

**۲. مشاهده و مدیریت کاردکس (Kardex Dashboard)**
*   **Timeline View:** نمایش گرافیکی ۲۴ ساعته.
*   **فیلدهای نمایش داده شده در هر سلول:** نام دارو، دوز، زمان مقرر، وضعیت (Due, Taken, Missed).
*   **Action:** کلیک روی هر آیتم -> باز شدن مودال ثبت وضعیت (Administer/Skip).

### ب) پنل بیمار (Patient Panel)

**۱. کارت دارویی (Medication Card)**
*   **نمایش ساده:** نام، دوز، شکل دارویی (آیکون)، زمان مصرف بعدی.
*   **دستورات:** نمایش فیلد `Instructions` به صورت برجسته.
*   **وضعیت:** نمایش وضعیت آخرین دوز (مصرف شده/فراموش شده).

---

## ۲. ساختار پیشنهادی UI (Component Architecture)

ایجاد ماژول جدید در `src/features/medications`:

```
src/features/medications/
├── components/
│   ├── wizard/                 # فرم چندمرحله‌ای افزودن دارو (Admin/Nurse)
│   │   ├── Step1_DrugInfo.tsx
│   │   ├── Step2_Scheduling.tsx
│   │   ├── Step3_Safety.tsx
│   │   ├── Step4_Notifications.tsx
│   │   └── MedicationWizard.tsx # Container اصلی
│   ├── kardex/                 # نمای کاردکس (Admin/Nurse)
│   │   ├── KardexTimeline.tsx
│   │   ├── KardexItem.tsx
│   │   └── AdministrationModal.tsx
│   ├── patient/                # نمای بیمار
│   │   ├── PatientMedicationList.tsx
│   │   └── MedicationCard.tsx
│   └── shared/
│       ├── TimePicker.tsx      # کامپوننت انتخاب ساعت (Persian support)
│       └── StatusBadge.tsx
├── hooks/
│   ├── useMedicationForm.ts    # مدیریت استیت فرم و Wizard
│   └── useKardexSchedule.ts    # منطق زمان‌بندی
└── types/
    └── form-schema.ts          # تعریف Zod Schema با تمام فیلدهای موجود
```

## ۳. برنامه اجرایی (Action Plan)

1.  **Setup & Types:**
    *   ایجاد ساختار فولدرها.
    *   تعریف Zod Schema دقیق با تمام فیلدهای `MedicationForm` فعلی.

2.  **Implement Admin/Nurse UI:**
    *   پیاده‌سازی `MedicationWizard` (جایگزین `MedicationForm` فعلی).
    *   پیاده‌سازی `KardexTimeline` (جایگزین جدول فعلی).

3.  **Implement Patient UI:**
    *   پیاده‌سازی لیست ساده و کارت‌های دارویی.

4.  **Integration:**
    *   جایگزینی کامپوننت‌های قدیمی در صفحات پروفایل بیمار.
    *   اطمینان از کارکرد صحیح APIها با ساختار جدید (بدون تغییر در Backend فعلا).

آیا این طرح مورد تایید است؟ (شروع با پیاده‌سازی `MedicationWizard`).